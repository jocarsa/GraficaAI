<html>
	<head>
	
		<style>
			/* Fran va a hacer el CSS del Canvas*/ 
			#grafica{
				border-style: groove;
				border-width: 2px 2px 10px 2px;
				border-color: #313842;
				border-radius: 5px;
				background-color: #e3e5e8;
				
			  
				
			}
			body{
			text-align: center;
			}
			h1 {
					color: #e8eef7;
					font-family: Arial, Helvetica, sans-serif;
					text-shadow: 5px 3px #313842;
				}
		</style>
		<style>
			/* Manu va a hacer el CSS de la propia pagina */


			body {
				background-image: url("paper.jpg");
				background-size: cover;
			}



		</style>
	</head>
	<body>
	
		<h1>Grafica Fantasma</h1>
		<canvas id="grafica" width=512px height=512px>
		<script>
			var contexto = document.getElementById("grafica").getContext("2d");			
			
			// Origen de los ejes
			var origenX = grafica.width/2;
			var origenY = grafica.height/2;
			
			contexto.lineWidth = 2;			
			// Eje X
			contexto.lineWidth = 2;
			contexto.strokeStyle = "Red";
			contexto.beginPath();
			contexto.moveTo(0,origenY);
			contexto.lineTo(grafica.width,origenY);
			contexto.stroke();			
			// Eje Y
			contexto.lineWidth = 3;
			contexto.strokeStyle = "Green";
			contexto.beginPath();
			contexto.moveTo(origenX,0);
			contexto.lineTo(origenX,grafica.height);
			contexto.stroke();
			
			var datos = [
				[230, 420],
				[210, 410],
				[200, 400],
				[0, 100],
				[20, 100],
				[40, 100],
				[50, 80],
				[300, 600],
				[260, 570],
				[270, 620],
				[260, 650],
				[100, 150],
				[110, 160],
				[105, 170],
				[104, 155],
				[110, 155],
				[70, 200]
			];
			/* Salva va a alimentar de datos reales la gráfica*/
			function IARegistro() {
				// Propiedades
				this.iteracion;
				this.posXJugador; 
				this.posXBot; 
				this.posYBot; 
				this.dirBot;
				this.acierto;
				// Métodos
			}
			
			var trainingSet = new Array();		
			
			
			var datos3 = [
			[0, 0, 0]
			];	
			
			function obtenerDatos(){
			
				var db_name = 'trainingSetDB';
				var db_version = '1.0';
				var db_describe = 'BD trainingSetDB';
				var db_size = 10 * 1024 * 1024;
				var db = openDatabase(db_name, db_version, db_describe, db_size, function(db) {        
					console.log("Database opened Successfully! Or created for the first time !");        
				});
				
				db.transaction(function(tx) {
					tx.executeSql(
								"SELECT * FROM registro ",
								[],
								//////////////////////////
								function(sqlTransaction, sqlResultSet) {									
									var rows;
									var len;
									
									rows = sqlResultSet.rows;
									len = rows.length;
									
									for (var i = 0; i < sqlResultSet.rows.length; i++){
										//datos3[i] = [sqlResultSet.rows.item(i).posXJugador,sqlResultSet.rows.item(i).posXBot,sqlResultSet.rows.item(i).posYBot];										
										trainingSet[i] = new IARegistro();	
										trainingSet[i].conjunto = sqlResultSet.rows.item(i).conjunto;
										trainingSet[i].iteracion = sqlResultSet.rows.item(i).iteracion;
										trainingSet[i].posXJugador = sqlResultSet.rows.item(i).posXJugador;
										trainingSet[i].posXBot = sqlResultSet.rows.item(i).posXBot;
										trainingSet[i].posYBot = sqlResultSet.rows.item(i).posYBot;
										trainingSet[i].movimientoBot = sqlResultSet.rows.item(i).movimientoBot;
										trainingSet[i].acierto = sqlResultSet.rows.item(i).acierto;
									}				
									console.log(rows.length + " filas cargadas");
									console.table(trainingSet);
									
									// Una vez ha rellenado el array de datos lanza el inicio
									inicio();
									
									
								},								
								//////////////////////////
								function(sqlTransaction, sqlError) {
									switch (sqlError.code) {
									case sqlError.SYNTAX_ERR:
										console.error("Syntax error has occurred. " + sqlError.message);
										break;
									default:
										console.error("Other error");
									}
								}
					);
				}, transError, transSuccess);	
				
			}

			function transError(t, e) {
				/*
				console.log(t);
				console.log(e);
				console.error("Error occured ! Code:" + e.code + " Message : " + e.message);
				*/
			}

			function transSuccess(t, r) {
				/*
				console.info("Transaction completed Successfully!");
				console.log(t);
				console.log(r);
				*/
			}			
			
			var mibucle;					
			var listEsferasGrupales;
			
			obtenerDatos();			
			// Salva: el inicio se llama desde obtenerDatos, porque se utilizan transacciones WebSQL asíncronas
			//inicio(); 
			
			function inicio(){
			
				// Gabri + Raul va a repasar la información de Salvador, y va a establecer grupos de puntos en base a un thresold
				// Si radio = 5, el sistema debe detectar qué puntos estan mas cerca de 5, y dibujar un circulo conteniendolos
				listEsferasGrupales = [[43, 365], [412, 12], [123, 456], [12, 12], [256, 256]];
				contexto.beginPath();
				for (var i = 0; i < datos.length; i++) {
					contexto.arc(datos[i][0], datos[i][1], 5, 0, 2*Math.PI);
					contexto.fillStyle = "black";
					contexto.fill();
					contexto.closePath();
				}
				
				/* Tirar una linea entre cada pareja de puntos que este a menos del umbral */
				/*////////////////////////////////CAMBIAR NOMBRE VARIABLE////////////////////////////////////*/
				for (var i = 0; i < parejas de puntos que estén a menos del umbral.length; i++){
					dibujaLinea(puntomedio(punto1),puntomedio(punto2)); 
				}
					      //FALTA CAMBIAR OBJETOS POR LOS VALORES FINALES//
				mibucle = setTimeout("bucle()",5000);
			}
			
			function bucle(){


				
				for (var i=0; i<listEsferasGrupales.length; i++) {
					//Cogemos radio y posicion del punto
					let posx = listEsferasGrupales[i][0];
					let posy = listEsferasGrupales[i][1];
					let radio = 20;
					contexto.strokeStyle = "orange";
					contexto.beginPath();
					contexto.arc(posx, posy, radio, 0, 2*Math.PI, false);
					contexto.stroke();
					contexto.closePath();
				}
				


				clearTimeout(mibucle);
				mibucle = setTimeout("bucle()",5000);
			}
			

			//Funcion para objeter el punto medio entre dos objetos//
			function puntoMedio(objeto){
				var posx = objeto[0]
				var posy = objeto[1]
				var centro = new array[posx,posy]
				return centro;
			}
			
			//funcion para dibujar una linea entre dos puntos//
			function dibujaLinea(objeto1,objeto2){
					
					contexto.beginPath();
					contexto.moveTo(objeto1[0], objeto1[0]);
					contexto.lineTo(objeto1, objeto2);
					contexto.stroke();


			}
		</script>
	</body>
</html>