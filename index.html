<html>
	<head>
	
		<style>
			/* Fran va a hacer el CSS del Canvas*/ 
			#grafica{
				border-style: groove;
				border-width: 2px 2px 10px 2px;
				border-color: #ccae72;
				border-radius: 5px;
				
			  
				
			}
			body{
			text-align: center;
			}
			h1 {
					color: a08b61;
					text-shadow: 3px 2px 59544b;
				}
		</style>
		<style>
			
		</style>
	</head>
	<body>
	
		<h1>Grafica Fantasma</h1>
		<canvas id="grafica" width=512px height=512px>
		<script>
			var contexto = document.getElementById("grafica").getContext("2d");
			
			// Origen de los ejes
			var origenX = grafica.width/2;
			var origenY = grafica.height/2;
			
			// Eje X
			contexto.lineWidth = 2;
			contexto.strokeStyle = "Red";
			contexto.beginPath();
			contexto.moveTo(0,origenY);
			contexto.lineTo(grafica.width,origenY);
			contexto.stroke();
			// Eje Y
			contexto.lineWidth = 3;
			contexto.strokeStyle = "Green";
			contexto.beginPath();
			contexto.moveTo(origenX,0);
			contexto.lineTo(origenX,grafica.height);
			contexto.stroke();
			
			var datos = [
				[210, 230, 420],
				[101, 70, 200],
				[104, 210, 410],
				[306, 200, 400],
				[250, 0, 100],
				[340, 20, 100],
				[89, 40, 100],
				[120, 50, 80],
				[45, 300, 600],
				[1, 260, 570],
				[10, 270, 620],
				[500, 260, 650],
				[278, 100, 150],
				[111, 110, 160],
				[433, 105, 170],
				[344, 104, 0155],
				[121, 110, 155]
			];
			
			var umbral = 100;
			var puntosAgrupados = new Array();
			var grupo = 0;
			
			/* Salva va a alimentar de datos reales la gráfica*/
			
			
			
			var mibucle;
			
			var listEsferasGrupales;
			
			inicio();
			
			//Funcion para calcular distancia entre dos puntos (dados en array)
			function distanciaPuntos(p1, p2) {
				return Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2));
			}
			
			function calcularGrupoDePunto(punto, puntos) {
				for (var i = 0; i < puntos.length; i++) {
					if (puntos[i][1] == punto[0] && puntos[i][2] == punto[1]) {
						return puntos[i][3];
					}
				}
				return -1;
			}
			
			function inicio(){
				// Gabri + Raul va a repasar la información de Salvador, y va a establecer grupos de puntos en base a un thresold
				// Si radio = 5, el sistema debe detectar qué puntos estan mas cerca de 5, y dibujar un circulo conteniendolos
				
				//-----------------------------------------
				//Busqueda de puntos por debajo del umbral
				for (var i = 0; i < datos.length; i++) {
					var punto1 = [datos[i][1], datos[i][2]];
					console.log("bucle i, iteracion: " + i);
					for (var j = i + 1; j < datos.length; j++) {
						var punto2 = [datos[j][1], datos[j][2]];
						console.log("bucle j, iteracion: " + j);
						console.log("punto 1: " + punto1);
						console.log("punto 2: " + punto2);
						var distancia = distanciaPuntos(punto1, punto2);
						console.log("distancia: " + distancia);
						if (distancia <= umbral) {
							console.log("Los puntos están cercanos");
							// Calculamos los grupos a los que pertenecen los puntos
							// En caso de no pertenecer a un grupo devolverá valor -1
							var grupoPunto1 = calcularGrupoDePunto(punto1, puntosAgrupados);
							var grupoPunto2 = calcularGrupoDePunto(punto2, puntosAgrupados);
							// Si el punto 1 pertenece a un grupo pero el punto 2 no, entonces insertamos el punto 2 en el grupo del punto 1
							if (grupoPunto1 != -1 && grupoPunto2 == -1) {
								puntosAgrupados.push([datos[j][0], punto2[0], punto2[1], grupoPunto1]);
							// Si el punto 2 pertenece a un grupo pero el punto 1 no, entonces insertamos el punto 1 en el grupo del punto 2
							} else if (grupoPunto1 == -1 && grupoPunto2 != -1) {
								puntosAgrupados.push([datos[i][0], punto1[0], punto1[1], grupoPunto2]);
							// Si ninguno de los puntos pertenece a un grupo los insertamos en un grupo nuevo
							} else if (grupoPunto1 == -1 && grupoPunto2 == -1){
								puntosAgrupados.push([datos[i][0], punto1[0], punto1[1], grupo]);
								puntosAgrupados.push([datos[j][0], punto2[0], punto2[1], grupo]);
								grupo++;
								console.log("grupo aumentado: " + grupo);
							}
						}
					}
					// Si el punto 1 no está cerca de ningún punto, entonces lo metemos en un grupo nuevo
					if (calcularGrupoDePunto(punto1, puntosAgrupados) == -1) {
						puntosAgrupados.push([datos[i][0], punto1[0], punto1[1], grupo]);
						grupo++;
						console.log("grupo aumentado: " + grupo);
					}
				}
				
				console.log(puntosAgrupados);
				
				//Modificar lista de esferas grupales
				listEsferasGrupales = [[43, 365], [412, 12], [123, 456], [12, 12], [256, 256]];
				
				
				//------------------------------------------
				contexto.beginPath();
				for (var i = 0; i < datos.length; i++) {
					contexto.arc(datos[i][1], datos[i][2], 5, 0, 2*Math.PI);
					contexto.fillStyle = "black";
					contexto.fill();
					contexto.closePath();
				}
				
				/* Tirar una linea entre cada pareja de puntos que este a menos del umbral */

				mibucle = setTimeout("bucle()",5000);
			}
			
			function bucle(){


				
				for (var i=0; i<listEsferasGrupales.length; i++) {
					//Cogemos radio y posicion del punto
					let posx = listEsferasGrupales[i][0];
					let posy = listEsferasGrupales[i][1];
					let radio = 20;
					contexto.strokeStyle = "orange";
					contexto.beginPath();
					contexto.arc(posx, posy, radio, 0, 2*Math.PI, false);
					contexto.stroke();
					contexto.closePath();
				}
				


				clearTimeout(mibucle);
				mibucle = setTimeout("bucle()",5000);
			}
		</script>
	</body>
</html>